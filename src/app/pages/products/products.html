<div class="category-container">
  <h2 class="page-heading">Product Management</h2>

  <!-- Filter/Search -->
  <div class="controls-row">
    <div class="filter-search">

      <div class="search-box">
        <input type="text" placeholder="Search Products..." [(ngModel)]="searchTerm">
        <i class="fa fa-search"></i>
      </div>
    </div>
    <button class="btn-add" (click)="openModal()">+ Add Product</button>
  </div>

  <!-- Table -->
  <div class="table-3d">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Product Name</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let prod of filteredProducts() | paginate: { itemsPerPage: pageSize, currentPage: currentPage }">
          <td>{{prod.id}}</td>
          <td>{{prod.name}}</td>
          <td>{{prod.finalPrice | currency}}</td>
          <td>{{prod.stock}}</td>
          <td>
            <button class="btn-edit" (click)="editProduct(prod)">Edit</button>
            <button class="btn-delete" (click)="deleteProductConfirm(prod.id)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
    <pagination-controls (pageChange)="currentPage = $event"></pagination-controls>
  </div>
</div>

<!-- Add/Edit Modal -->
<div class="modal-backdrop" *ngIf="showModal">
  <div class="modal-3d">
    <h3 style="text-align:center">{{editMode ? 'Edit Product' : 'Add Product'}}</h3>

    <!-- Tabs -->
    <div class="tabs">
      <button [class.active]="activeTab==='basic'" (click)="setActiveTab('basic')">Basic Info</button>
      <button [class.active]="activeTab==='pricing'" (click)="setActiveTab('pricing')">Pricing</button>
      <button [class.active]="activeTab==='images'" (click)="setActiveTab('images')">Images</button>
      <button [class.active]="activeTab==='category'" (click)="setActiveTab('category')">Category</button>
      <button [class.active]="activeTab==='seo'" (click)="setActiveTab('seo')">SEO</button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Basic Info -->
      <div *ngIf="activeTab==='basic'">
        <label>Product Name</label>
        <input type="text" [(ngModel)]="productModel.name" placeholder="Name">

        <label>Slug</label>
        <input type="text" [(ngModel)]="productModel.slug" placeholder="Slug">

        <label>Brand</label>
        <input type="text" [(ngModel)]="productModel.brand" placeholder="Brand">

        <label>Description</label>
        <textarea [(ngModel)]="productModel.description" placeholder="Description"></textarea>

        <label>Short Description</label>
        <textarea [(ngModel)]="productModel.shortDescription" placeholder="Short Description"></textarea>
      </div>

      <!-- Pricing -->
      <div *ngIf="activeTab==='pricing'">
        <label>Price</label>
        <input type="number" [(ngModel)]="productModel.price" (input)="productModel.finalPrice = calculateFinalPrice()">

        <label>Discount (%)</label>
        <input type="number" [(ngModel)]="productModel.discount" (input)="productModel.finalPrice = calculateFinalPrice()">

        <label>Final Price</label>
        <input type="number" [value]="productModel.finalPrice ?? 0" readonly>

        <label>Stock</label>
        <input type="number" [(ngModel)]="productModel.stock">
      </div>

      <!-- Images -->
      <div *ngIf="activeTab==='images'">
        <input type="file" (change)="onFileChange($event)" multiple>
        <div class="image-preview">
          <img *ngFor="let img of productModel.images" [src]="img" width="80" height="80">
        </div>
      </div>

      <!-- Category -->
      <div *ngIf="activeTab==='category'">
        <label>Category</label>
        <input type="text" [(ngModel)]="productModel.category" placeholder="Category">
      </div>

      <!-- SEO -->
      <div *ngIf="activeTab==='seo'">
        <label>SEO Title</label>
        <input type="text" [(ngModel)]="productModel.seoTitle" placeholder="SEO Title">

        <label>SEO Description</label>
        <textarea [(ngModel)]="productModel.seoDescription" placeholder="SEO Description"></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-save" (click)="saveProduct()">{{editMode ? 'Update' : 'Add'}}</button>
      <button class="btn-cancel" (click)="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showConfirmModal">
  <div class="modal-3d">
    <h3 style="text-align:center; margin-bottom:20px;">Confirm Deletion</h3>
    <p style="text-align:center; margin-bottom:30px;">Are you sure you want to delete this product?</p>

    <div class="modal-footer">
      <button class="btn-cancel" (click)="cancelDelete()">Cancel</button>
      <button class="btn-delete" (click)="confirmDelete()">Delete</button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div class="toast" *ngIf="showToast" [ngClass]="toastType">
  {{ toastMessage }}
</div>
